- 持久化连接以只支持连接重用
- 分块传输编码以支持流式响应
- 请求管道以支持并行请求处理
- 字节服务以支持基于范围的请求
- 改进的更好的缓存机制

**优化建议**
- 减少DNS查询
- 减少HTTP请求
- 使用CDN
- 添加expires首部并配置etag标签
- Gzip资源
- 避免http重定向

### 11.1 持久连接的优点
> - 没有持久连接，每次请求都会导致两次往返延迟
> - 由持久连接，只有第一次请求会导致两次往返延迟，后续请求只会导致一次往返延迟
> - 在启用持久连接时，N次请求节省的总延迟时间就是(N-1)*RTT。
### 11.2 HTTP管道
> 仅仅是持久连接，多起请求仍然需要满足FIFO的队列顺序：发送请求，等待响应完成，再发送下一条请求。
>
> 客户端通过向服务器端发送同时发送多个请求，不等待上一个请求的响应，相当于服务器端支持并发处理多个请求，这样就不会出现请求等待的情况。
>
> 但是请求的返回，仍然是要跟请求顺序一致。这样就会出现一些问题：
>
> - 一个慢响应会阻塞后面的请求
> - 并行处理请求时，服务器必须缓冲管道中的响应，从而占用服务器资源，容易成为服务器的受攻击面
> - 响应失败可能导致TCP连接终止，从而强迫客户端重新发送对所有后续资源的请求，导致重复处理
> - 由于可能存在代理，因此需要检测管道的兼容性以及可靠性
> - 如果中间代理不支持管道，那它可能会中断连接，也可能会把所有请求串联起来

### 11.3 使用多个TCP连接
> 客户端开启对服务器的多个TCP持久连接，一个接一个地发送请求。这样：
> - 客户端可以并行分派多个请求
> - 服务器可以并行处理多个请求
> - 第一次往返可以发送的累计分组数量（TCP cwnd）窗口增长为多倍
>
> 缺点是：
> - 多个TCP连接占用更多资源
> - 并行TCP流之间竞争共享的带宽
> - 由于处理多个Socket，复杂性更高
> - 即使并行TCP流，应用的并行能力也受限制

### 11.4 域名分区
- 利用好TCP，做好针对TCP连接的优化
- 浏览器会自动为你打开6个连接
- 资源的数量、大小和响应时间都会影响最优的分区数量
- 客户端延迟和带宽会影响最优的分区数量
- 域名分区会因为额外的DNS和TCP慢启动影响性能

### 11.5 度量和控制协议开销
> 有时候HTTP协议所携带的首部信息会占大量的开销，如果请求的实体部分过小，会导致很大的浪费（比如一次性只发送几个字节的数据，而每次请求都会由固定的大概几百字节的首部加请求行，这样其实很不划算）

### 11.6 连接与拼合
> 不管怎么说，减少请求次数总是最好的性能优化：
> - 连接：把多个JavaScript文件或CSS文件合为一个文件
> - 拼合：把多个图片和为一个更大的复合图片
> - 减少协议开销：通过把文件组合成一个资源，可以消除与文件相关的协议开销
> - 应用层传输：相当于应用层实现了管道

### 11.7 嵌入资源
> 把JavaScript代码和CSS代码写在页面文件中