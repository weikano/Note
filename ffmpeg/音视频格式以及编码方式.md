### 音视频格式以及编码方式

日常生活中的音视频文件都有不同的扩展名，比如avi, rmvb, mp4, flv等。这些格式代表的是**封装格式**，即将视频数据和音频数据打包成一个文件的规范。通过文件扩展名，很难看出具体使用了什么音视频编码方式。

#### 1. 视频播放器原理

视频播放器播放一个网络上的视频文件，需要以下几个步骤：解协议、解封装、解码音视频以及音视频同步。

如果是本地文件则不需要解协议。

- 解协议

  > 将流媒体协议的数据，解析为标准的相应的封装格式数据。例如采用RTMP协议传输的数据，结果解协议操作后，输出FLV格式的数据。

- 解封装

  > 将输入的封装格式数据，分离为音频流亚索编码数据和视频流压缩编码数据。封装格式有很多，比如MKV、MP4、RMVB、TS、FLV等，它的作用是将以及压缩编码的音视频数据按照一定格式放到一起。
  >
  > 比如FLV格式的数据，解封装后输出H264的视频码流和AAC编码的音频码流。

- 解码

  > 将视频/音频压缩编码数据，解码成非压缩的原始数据。音频压缩编码标准包括AAC、MP3等等，视频压缩编码标准有H.264、H.265等。通过解码，压缩编码的视频数据输出为非压缩的颜色数据，比如YUV420P、RGB等。音频输出为非压缩的音频抽样数据，例如PCM数据。

- 音视频同步

  > 根据解封装模块处理过程中获取到的参数信息，同步解码出来的视频和音频数据，并将视频和音频数据送至系统的显卡和声卡播放。

#### 2. 流媒体协议

略

#### 3. 封装格式

不同的封装格式支持不同的音视频编码方式，但是只有AVI格式不支持流媒体，其他封装格式都可以“边下边播”

#### 4. 视频编码

视频编码主要将视频像素数据(RGB、YUV等)压缩为视频码流，从而降低视频的数据量。高效率的视频编码在同等的码率下，可以获得更高的视频质量。

##### 4.1 主流编码标准

H.264仅仅是一个编码标准，而不是具体的编码器，只是给编码器的实现提供参照用的。

实际中使用最多的是x264，开源并且性能强悍。

##### 4.2 下一代编码标准

HEVC以及编码器x265

#### 5. 音频编码

音频编码用来将音频采样数据PCM等压缩成为音频码流，从而降低数据量。

#### 6. 现有网络音视频平台对比

网络音视频服务主要分为两种：点播和直播（互联网音视频平台直接将内容实时发送给用户）。

##### 6.1 直播平台参数对比

直播服务普遍采用了RTMP作为流媒体协议，FLV作为封装格式，H.264作为视频编码格式，AAC作为音频编码格式。

##### 6.2 点播平台参数对比

点播服务普遍采用了http作为流媒体协议，H.264作为视频编码格式，AAC作为音频编码格式。