### 第1章-越用越卡为哪般-降低待机内存

#### 1.4.2 smaps

**dalvik heap之外的所有信息都能够从/proc/pid/smaps中取得**

```shell
//adb shell dumpsys meminfo [options] [process]
adb shell dumpsys meminfo -a com.zhihu.daily
```

dumpsys统计各个内存块的pss, shared_dirty, private_dirty等值，并按以下原则进行了归并：

- /dev/ashmem/dalvik-heap和/dev/ashmem/dalvik-zygote归为dalvik heap。
- 其它以/dev/ashmem/dalvik-开头的内存区域归为dalvik other。
- ashmem对应为/dev/ashmem/下所有以dalvik-开头的内存区域。
- Other dev对应的是以/dev下其他的内存区域。
- 文件的mmap按已知的几个扩展名分类，其余的归为other mmap。
- 其他部分，如stack，malloc，unknown等。

**Dalvik**

最常见的方法就是减少dalvik heap中创建的对象，能够直接减少dalvik heap，并间接减少accounting部分。减少代码会直接减少运行辅助部分，包括code_cache（jit编译代码后的缓存）。

在加载class时，会根据类的变量个数以及函数个数申请相应大小的内存，作为运行时的内部指针。优化方法参见2.6节。

**mmap**

应用的dexh会通过mmap传到内存中，所以减小dex的尺寸能够降低这部分内存占用，同时也会减少dalvik部分的内存。





