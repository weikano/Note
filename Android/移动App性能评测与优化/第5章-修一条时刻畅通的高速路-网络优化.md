### 第5章-修一条时刻畅通的高速路-网络优化

##### 5.1.1 图片上传方案及雏形

1. 必须分小片传输一个文件

   > - 服务器不支持断点续传。
   > - 单个消息越大越容易失败。

2. 不同类型的网络下分片初始大小应该不同，分片大小需要实验。

   > 并不是分片越小越好，要考虑分片带来的额外http头以及每个分片的RTT。

3. 上传过程中，应当尽可能动态增大分片大小，类似tcp的传输，以减少分片。

4. 确定每个分片是否要继续增大之前，要检查网络类型是否发生变化。一旦跟前一片传输的网络不一样，那么就采用新网络类型下的初始分片大小，而不是继续增大。

5. 分片一旦失败，应该使用该网络类型下的初始分片大小进行重试，类似tcp的丢包处理。

6. 每个分片都有一定次数的失败重传机会，当一个分片的所有重传都失败了，才定义为图片传输失败。

7. 配合后台服务器能力，用户手工再次重试传输失败的图片时，能断电续传。

